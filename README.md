# yapi-autoapi

YAPI 接口自动化，生成 ts 文件，即用即取

## install

```
npm i yapi-autoapi -g
```

## 初始化

```
autoapi init
```

创建 autoapi.config.js 配置文件

```js
// ati.config.js
module.exports = {
  // yapi 项目 url
  url: '',
  // 项目 id
  projectId: '',
  // yapi 项目 token
  token: '',
  // interface 输出目录
  output: '',
  // 项目内的分组 id
  groupId: [],
  // (可选) 自定义 interface name
  customInterfaceName: (name, type) => {
    if (type === 'request') {
      return `${name}RequestType`
    } else {
      return `${name}ResponseType`
    }
  },
  // 支持自定义模板，只需要将按照以下格式传递即可
  // paramsContent， 入参+ 出参的内容，自动生成无需修改
  // functionName, 函数名，自动生成无需修改
  // reqName, 入参名，自动生成无需修改
  // resName, 出参名，自动生成无需修改
  // requestPath, 请求路径，自动生成无需修改
  customTemplate: (
    functionName,
    requestPath,
    requestInterfaceName,
    responseInterfaceName,
    paramsContent
  ) => {
    return `
    import request from 'request'

    ${paramsContent}
    
    export async function ${functionName}(data?: ${requestInterfaceName}): Promise<${responseInterfaceName}> {
      return request(${requestPath}, {
        method: 'post',
        data
      })
    }
    `
  }
}
```

## run： 自动生成 request 文件

```
autoapi run
```

## configs

| 属性                | 说明                        | 类型                | 默认值                                    |
| ------------------- | --------------------------- | ------------------- | ----------------------------------------- |
| url                 | yapi 项目 url               | string              |                                           |
| projectId           | 项目 id                     | string              |                                           |
| token               | yapi 项目 token             | string              |                                           |
| output              | interface 输出目录          | string              |                                           |
| groupId             | 项目内的分组 id             | string[]            |                                           |
| customInterfaceName | 自定义 interface name       | CustomInterfaceName |                                           |
| customTemplate      | 自定义生成文件内容          | CustomTemplate      |                                           |
| prettierConfig      | prettier 格式化配置文件路径 | string              | [工具内置 prettier 格式化配置](#prettier) |

其中`CustomTemplate`的类型定义如下：

```ts
type CustomTemplate = (
  //  生成函数名
  functionName: string,
  //  请求接口地址
  requestPath: string,
  //  请求参数类型名
  requestInterfaceName: string,
  //  响应参数类型名
  responseInterfaceName: string,
  //  参数类型定义内容
  paramsContent: string
) => string
```

### 生成结果

```js
import request from './lib/'
/* tslint:disable */
/* This file was automatically generated by auto-request-tool.
 * DO NOT MODIFY IT BY HAND.
 */
export interface UserInfoReq {
  /**
   * 用户id
   */
  userId: string
  /**
   * 用户姓名
   */
  userName?: string
  /**
   * 手机号
   */
  mobile?: string
  /**
   * 是否男性
   */
  male?: boolean
}

export interface UserInfoRes {
  /**
   * id
   */
  id: number
  /**
   * 用户id
   */
  userId: string
  /**
   * 用户姓名
   */
  userName?: string
  /**
   * 手机号
   */
  mobile?: string
  /**
   * 是否男性
   */
  male?: boolean
  /**
   * 头像
   */
  avatar?: string
}

export async function confirmAudit(data: UserInfoReq): Promise<UserInfoRes> {
  return request('/autoapi/request/getUserInfo', {
    method: 'post',
    data
  })
}
```

<H4 id='prettier'>Prettier 内置格式化规范</H4>

```js
module.exports = {
  // 一行最多 100 字符
  printWidth: 100,
  // 使用 2 个空格缩进
  tabWidth: 2,
  // 不使用缩进符，而使用空格
  useTabs: false,
  // 行尾需要有分号
  semi: false,
  // 使用单引号
  singleQuote: true,
  // 对象的 key 仅在必要时用引号
  quoteProps: 'as-needed',
  // jsx 不使用单引号，而使用双引号
  // jsxSingleQuote: false,
  // 末尾不需要逗号
  trailingComma: 'none',
  // 大括号内的首尾需要空格
  bracketSpacing: true,
  // jsx 标签的反尖括号需要换行
  jsxBracketSameLine: false,
  // 箭头函数，只有一个参数的时候，也需要括号
  arrowParens: 'always',
  // 每个文件格式化的范围是文件的全部内容
  rangeStart: 0,
  rangeEnd: Infinity,
  // 不需要写文件开头的 @prettier
  requirePragma: false,
  // 不需要自动在文件开头插入 @prettier
  insertPragma: false,
  // 使用默认的折行标准
  proseWrap: 'preserve',
  // 根据显示样式决定 html 要不要折行
  htmlWhitespaceSensitivity: 'css',
  // 换行符使用 lf
  endOfLine: 'lf'
}
```
